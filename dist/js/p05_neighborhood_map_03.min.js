$(document).ready(function(){"use strict";try{var e=function(){var e=this;e.bounds=new google.maps.LatLngBounds,e.infowindow=new google.maps.InfoWindow,e.mainLocation=ko.observable({cat:"my favorites",name:"Barbican Centre",address:"EC2Y 8DS",city:"london",lat:51.5204543,lng:-.0937136999999666,description:"Great venue for music, cinema and exhibitions.",url:"http://www.barbican.org.uk/",img:"",type:"my favorites",visible:!0}),e.ticker=ko.observable("Real Time FTSE Ticker"),ko.bindingHandlers.flash={update:function(e,o){ko.utils.unwrapObservable(o()),$(e).hide().fadeIn(700)}},e.myLocations=ko.observableArray(myfavs),e.searchcategory="coworking",e.locations=ko.observableArray(),e.query=ko.observable(""),e.computedLocations=ko.computed(function(){return ko.utils.arrayFilter(e.locations(),function(o){return o.name.toLowerCase().indexOf(e.query().toLowerCase())>=0})});var o="SNOQCJIS13MCJ0IWGDEUNKLZGPVY5MQVSPNFF0Z1CXMV5MH2",n="Z2PFXOJSYNMAU5XIM41HFD4TKHA0KRICYUPI3W0ZQVZFNPW3",t="https://api.foursquare.com/v2/venues/explore?client_id="+o+"&client_secret="+n+"&v=20150101&ll="+e.mainLocation().lat+","+e.mainLocation().lng+"&radius=2500&query="+e.searchcategory;$.ajax({dataType:"json",url:t,timeout:6e3}).fail(function(){alert("We are experiencing problems with the FourSquare interface. We apologise for the inconvenience. Please try again later"),a()}).done(function(o){$.each(o.response.groups[0].items,function(o,n){var t={cat:n.venue.categories[0].name,name:n.venue.name,address:n.venue.location.address,city:n.venue.location.city+" "+n.venue.location.country,lat:n.venue.location.lat,lng:n.venue.location.lng,description:"",url:n.venue.url,img:"",type:"foursquare",visible:!0,marker:{}};e.locations.push(t)}),a(),e.computedLocations.subscribe(function(){r()})});var a=(function(){try{e.map=new google.maps.Map(document.getElementById("map-canvas"),{zoom:15,streetViewControl:!1,center:new google.maps.LatLng(e.mainLocation().lat,e.mainLocation().lng),mapTypeId:google.maps.MapTypeId.ROADMAP})}catch(o){alert("We are experiencing problems with the Google Maps interface. We apologise for the inconvenience. Please try again later")}google.maps.event.addDomListener(window,"resize",function(){e.map.fitBounds(e.bounds),e.map.setCenter(e.bounds.getCenter())})}(),function(){var o=function(o){var n="http://maps.google.com/mapfiles/ms/icons/green-dot.png",t="http://maps.google.com/mapfiles/ms/icons/red-dot.png",a="http://maps.google.com/mapfiles/ms/icons/purple-dot.png",r=t,s=new google.maps.LatLng(o.lat,o.lng);r="Coworking Space"===o.cat?a:n;var l=new google.maps.Marker({map:e.map,animation:google.maps.Animation.DROP,position:s,title:o.name,icon:r});o.marker=l,e.bounds.extend(s);var c=o.url?'<p><a href="'+o.url+'" target="_blank">'+o.url+"<a></p>":"<p>no url</p>",m='<div id="infowindow"><p>'+o.name+"</p><p>"+o.cat+"</p>"+c+"<p>"+o.description+"</p></div>";l.info=new google.maps.InfoWindow({content:m,maxWidth:274}),l.infocontent=m,google.maps.event.addListener(l,"click",function(){i(l,e.map)})};$.each(e.myLocations(),function(e,n){o(n)}),$.each(e.computedLocations(),function(e,n){o(n)}),e.map.fitBounds(e.bounds),e.map.setCenter(e.bounds.getCenter())}),i=function(o,n){e.infowindow.setContent(o.info.content),e.infowindow.open(n,o),o.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){o.setAnimation(null)},710)},r=function(){var o=$(e.locations()).not(e.computedLocations()).get();$.each(o,function(e,o){o.visible&&(o.marker.setMap(null),o.visible=!1)}),$.each(e.computedLocations(),function(o,n){n.marker&&!n.visible&&(n.marker.setMap(e.map),n.visible=!0,e.bounds.extend(n.marker.position))}),e.map.fitBounds(e.bounds),e.map.setCenter(e.bounds.getCenter())};e.locationClickHandler=function(o){i(o.marker,e.map)};!function(){var o=function(){var o="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quoteslist%20where%20symbol%3D'%5EFTSE'&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=";$.ajax({dataType:"json",type:"GET",url:o,timeout:6e3}).fail(function(){alert("We are experiencing problems with the Yahoo interface. We apologise for the inconvenience. Please try again later")}).done(function(o){e.ticker("FTSE: "+o.query.results.quote.LastTradePriceOnly+" "+o.query.results.quote.LastTradeTime)})};setInterval(o,15e3)}()};ko.applyBindings(new e)}catch(o){alert("We are experiencing a general problem. We apologise for the inconvenience. "+o)}});var myfavs=[{cat:"my favorites",name:"Barbican Centre",address:"EC2Y 8DS",city:"london",lat:51.5204543,lng:-.0937136999999666,description:"Great venue for music, cinema and exhibitions.",url:"http://www.barbican.org.uk/",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Google",address:"SW1W 9tq",city:"london",lat:51.49496560000001,lng:-.14667389999999614,description:"The Mothership",url:"https://www.google.com",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Barbican Cinemas Cafe",address:"Beech Street",city:"london",lat:51.5205906,lng:-.09486970000000383,description:"<p>Besides showing movies of great quality from all over the world, this is also a friendly space open</p><p> to the public used by people to work, teach, learn, meet etc...</p><p>I do a lot of coding here...</p>",url:"",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Silicon Roundabout",address:"EC1Y 1BE",city:"london",lat:51.52567029999999,lng:-.08756149999999252,description:"London's answer to Silicon Valley. Dirty, smogged, dangerous, noisy. Ugly!",url:"",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Shoreditch High Street station",address:"Shoreditch High Street station",city:"london",lat:51.52338,lng:-.07521999999994478,description:"HERE BE HIPSTERS!",url:"",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Apple store",address:"W1B 2EL",city:"london",lat:51.5142651,lng:-.14222989999996116,description:"First store to open in Europe in 2004",url:"http://tinyurl.com/kwo7qnz",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Boxpark shoreditch",address:"E1 6gy",city:"london",lat:51.52338109999999,lng:-.07573070000000826,description:"popup stores and interesting street foods. very HIP! do not come here unless you sport a modern beard",url:"",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Silicon Milkroundabout",address:"E1 6QL",city:"london",lat:51.5217064,lng:-.0722892999999658,description:"",url:"",img:"",type:"readonly",visible:!0},{cat:"my favorites",name:"Royal Festival Hall",address:"SE1 8XX",city:"london",lat:51.5055375,lng:-.1156066,description:"",url:"",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"London Hackspace",address:"E2 9DY",city:"london",lat:51.531801,lng:-.060318,description:"Great space for hacking and building things.",url:"https://london.hackspace.org.uk/",img:"",type:"my favourites",visible:!0},{cat:"my favorites",name:"Impact Hub Westminster",address:"SW1Y 4TE",city:"london",lat:51.5078348,lng:-.1316065,description:"",url:"http://westminster.impacthub.net/",img:"",type:"my favourites",visible:!0}];